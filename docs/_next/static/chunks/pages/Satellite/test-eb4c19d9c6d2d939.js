(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[466],{9661:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Satellite/test",function(){return i(3939)}])},5814:function(e,t,i){"use strict";i.r(t);var s=i(5271),n=i(1521),a=i(9768),l=i(9363);t.default=e=>{let{satellites:t,onSatelliteClick:i}=e,{scene:o,resourceManager:r,isInitialized:c}=(0,s.useContext)(l.SceneContext),d=(0,s.useRef)({meshes:[],satelliteIds:[],selectedIndex:null,highlightMeshes:new Map});return(0,s.useEffect)(()=>{if(!o||!r||!c||0===t.length){console.log("Satellite: 条件不满足，跳过加载",{scene:!!o,resourceManager:!!r,isInitialized:c,satellitesLength:t.length});return}console.log("Satellite: 开始加载卫星模型",{satellitesCount:t.length,satellites:t.map(e=>({id:e.id,name:e.name,position:e.position,model:e.model}))}),d.current.meshes.length>0&&(d.current.meshes.forEach(e=>{o.remove(e),e.traverse(e=>{e instanceof n.Kj0&&(e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose()))})}),d.current.highlightMeshes.forEach(e=>{o.remove(e),e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose())}));let e=[],s=t.map(e=>e.id);return t.forEach(t=>{let[s,l,r]=t.position;try{console.log("Satellite: 开始加载模型",t.model),new a.E().load(t.model,a=>{console.log("卫星加载成功:",t.id,t.model,{scene:a.scene,animations:a.animations,asset:a.asset,sceneChildren:a.scene.children.length});let c=a.scene;c.position.set(s,l,r);let d=1;switch(t.id){case"satellite-1":case"satellite-3":d=3;break;case"satellite-2":d=1;break;case"satellite-4":d=2.5;break;case"satellite-5":d=3.5;break;default:d=2}c.scale.set(d,d,d),c.name="satellite-".concat(t.id);let m=new n.ZzF().setFromObject(c);console.log("Satellite: 模型包围盒信息",JSON.stringify({satelliteId:t.id,scale:d,min:m.min,max:m.max,size:m.getSize(new n.Pa4),center:m.getCenter(new n.Pa4)})),c.userData={isClickable:!0,satelliteId:t.id,onSatelliteClick:i},c.traverse(e=>{e instanceof n.Kj0&&(e.userData={isClickable:!0,satelliteId:t.id,onSatelliteClick:i})});let u=new n.Ox3(16777215,1);u.position.set(5,5,5),u.target=c,o.add(u);let h=new n.Mig(4210752,.6);o.add(h),o.add(c),e.push(c),console.log("Satellite: 卫星已添加到场景",JSON.stringify({satelliteId:t.id,modelName:c.name,position:c.position,visible:c.visible,sceneChildren:o.children.length,lightsAdded:!0}))},e=>{},a=>{console.error("卫星加载失败，使用备用几何体:",t.id,t.model,a),console.error("错误详情:",{message:(null==a?void 0:a.message)||"未知错误",type:(null==a?void 0:a.type)||"未知类型",url:t.model});let c=new n.DvJ(1.5,.8,3),d=new n.xoR({color:4473924,shininess:100}),m=new n.Kj0(c,d);m.position.set(s,l,r),m.name="satellite-".concat(t.id,"-fallback"),m.userData={isClickable:!0,satelliteId:t.id,onSatelliteClick:i},o.add(m),e.push(m),console.log("Satellite: 备用几何体已添加到场景",{satelliteId:t.id,meshName:m.name,position:m.position,visible:m.visible,sceneChildren:o.children.length})})}catch(m){console.error("Satellite: GLTFLoader 创建失败",m);let a=new n.DvJ(1,.5,2),c=new n.xoR({color:4473924,shininess:100}),d=new n.Kj0(a,c);d.position.set(s,l,r),d.name="satellite-".concat(t.id,"-fallback"),d.userData={isClickable:!0,satelliteId:t.id,onSatelliteClick:i},o.add(d),e.push(d)}}),d.current.meshes=e,d.current.satelliteIds=s,()=>{d.current.meshes.forEach(e=>{o.remove(e),e.traverse(e=>{e instanceof n.Kj0&&(e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose()))})}),d.current.highlightMeshes.forEach(e=>{o.remove(e),e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose())}),d.current={meshes:[],satelliteIds:[],selectedIndex:null,highlightMeshes:new Map}}},[o,r,c,t,i]),null}},5965:function(e,t,i){"use strict";i.r(t);var s=i(2676),n=i(5271),a=i(1521),l=i(9363),o=i(426),r=i(5814),c=i(5340);t.default=e=>{let{selectedSatellite:t}=e,{camera:i,controls:d,isInitialized:m,isLoaded:u}=(0,n.useContext)(l.SceneContext);return((0,n.useEffect)(()=>{i&&d&&(i.position.set(0,0,5),i.lookAt(0,0,0),d.update(),console.log("SatelliteScene: 相机位置设置完成",{position:i.position}))},[i,d]),(0,n.useEffect)(()=>{if(!i||!d||!t)return;let[e,s,n]=t.position,l=i.position.clone(),o=new a.Pa4(e+5,s+2,n+5),r=Date.now(),c=()=>{let t=Math.min((Date.now()-r)/1e3/1.5,1);i.position.lerpVectors(l,o,1-Math.pow(1-t,3)),i.lookAt(e,s,n),d.update(),t<1&&requestAnimationFrame(c)};c()},[t,i,d]),m)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.default,{}),(0,s.jsx)(o.default,{isRotating:!0,selectedSatellite:null==t?void 0:t.id}),!u&&(0,s.jsxs)("div",{className:"loading-container",children:[(0,s.jsx)("div",{className:"loading-spinner"}),(0,s.jsx)("p",{className:"loading-text",children:"正在加载地球模型..."})]}),t&&(0,s.jsx)(r.default,{satellites:[t],onSatelliteClick:()=>{}})]}):(0,s.jsxs)("div",{className:"loading-container",children:[(0,s.jsx)("div",{className:"loading-spinner"}),(0,s.jsx)("p",{className:"loading-text",children:"正在初始化3D场景..."})]})}},5340:function(e,t,i){"use strict";i.r(t);var s=i(5271),n=i(1521),a=i(9363);t.default=()=>{let{scene:e,isInitialized:t}=(0,s.useContext)(a.SceneContext),i=(0,s.useRef)({stars:null,animationId:null});return(0,s.useEffect)(()=>{if(!e||!t)return;let s=()=>{if(i.current.stars){let e=.001*Date.now(),t=i.current.stars.geometry.attributes.position.array;for(let i=0;i<t.length;i+=3){let s=.1*Math.sin(2*e+.1*i)+.9;t[i+1]+=.001*Math.sin(e+i)*s}i.current.stars.geometry.attributes.position.needsUpdate=!0}i.current.animationId=requestAnimationFrame(s)};return(()=>{let t=new n.u9r,s=new Float32Array(6e3),a=new Float32Array(6e3),l=new Float32Array(2e3);for(let e=0;e<2e3;e++){let t=3*e,i=50+50*Math.random(),o=Math.random()*Math.PI*2,r=Math.acos(2*Math.random()-1);s[t]=i*Math.sin(r)*Math.cos(o),s[t+1]=i*Math.sin(r)*Math.sin(o),s[t+2]=i*Math.cos(r);let c=new n.Ilk;c.setHSL(.6+.1*Math.random(),.8,.8+.2*Math.random()),a[t]=c.r,a[t+1]=c.g,a[t+2]=c.b,l[e]=2*Math.random()+.5}t.setAttribute("position",new n.TlE(s,3)),t.setAttribute("color",new n.TlE(a,3)),t.setAttribute("size",new n.TlE(l,1));let o=new n.jyz({vertexShader:"\n                    attribute float size;\n                    attribute vec3 color;\n                    varying vec3 vColor;\n                    void main() {\n                        vColor = color;\n                        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n                        gl_PointSize = size * (300.0 / -mvPosition.z);\n                        gl_Position = projectionMatrix * mvPosition;\n                    }\n                ",fragmentShader:"\n                    varying vec3 vColor;\n                    void main() {\n                        float distance = length(gl_PointCoord - vec2(0.5));\n                        if (distance > 0.5) discard;\n                        gl_FragColor = vec4(vColor, 1.0 - distance * 2.0);\n                    }\n                ",transparent:!0,depthWrite:!1,blending:n.WMw}),r=new n.woe(t,o);e.add(r),i.current.stars=r})(),s(),()=>{i.current.animationId&&cancelAnimationFrame(i.current.animationId),i.current.stars&&(e.remove(i.current.stars),i.current.stars.geometry.dispose(),i.current.stars.material.dispose())}},[e,t]),null}},3939:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return o}});var s=i(2676),n=i(5271),a=i(9363),l=i(5965);function o(){let e=(0,n.useRef)(null);return(0,s.jsx)("div",{style:{width:"100vw",height:"100vh",background:"#000"},children:(0,s.jsx)(a.default,{containerRef:e,children:(0,s.jsx)(l.default,{satellites:[{id:"test-satellite-1",name:"测试卫星1",model:"/models/satellite.glb",position:[5,0,0],description:"测试卫星"},{id:"test-satellite-2",name:"测试卫星2",model:"/models/satellite-demo01.glb",position:[-5,0,0],description:"测试卫星"}],onSatelliteClick:e=>{console.log("点击了卫星:",e),alert("点击了卫星: ".concat(e))},containerRef:e})})})}}},function(e){e.O(0,[593,944,577,768,426,774,888,179],function(){return e(e.s=9661)}),_N_E=e.O()}]);
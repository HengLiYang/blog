(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[83],{1413:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Satellite/components/SatelliteScene",function(){return i(5965)}])},5814:function(e,t,i){"use strict";i.r(t);var a=i(5271),s=i(1521),n=i(9768),l=i(9363);t.default=e=>{let{satellites:t,onSatelliteClick:i}=e,{scene:o,resourceManager:r,isInitialized:c}=(0,a.useContext)(l.SceneContext),d=(0,a.useRef)({meshes:[],satelliteIds:[],selectedIndex:null,highlightMeshes:new Map});return(0,a.useEffect)(()=>{if(!o||!r||!c||0===t.length){console.log("Satellite: 条件不满足，跳过加载",{scene:!!o,resourceManager:!!r,isInitialized:c,satellitesLength:t.length});return}console.log("Satellite: 开始加载卫星模型",{satellitesCount:t.length,satellites:t.map(e=>({id:e.id,name:e.name,position:e.position,model:e.model}))}),d.current.meshes.length>0&&(d.current.meshes.forEach(e=>{o.remove(e),e.traverse(e=>{e instanceof s.Kj0&&(e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose()))})}),d.current.highlightMeshes.forEach(e=>{o.remove(e),e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose())}));let e=[],a=t.map(e=>e.id);return t.forEach(t=>{let[a,l,r]=t.position;try{console.log("Satellite: 开始加载模型",t.model),new n.E().load(t.model,n=>{console.log("卫星加载成功:",t.id,t.model,{scene:n.scene,animations:n.animations,asset:n.asset,sceneChildren:n.scene.children.length});let c=n.scene;c.position.set(a,l,r);let d=1;switch(t.id){case"satellite-1":case"satellite-3":d=3;break;case"satellite-2":d=1;break;case"satellite-4":d=2.5;break;case"satellite-5":d=3.5;break;default:d=2}c.scale.set(d,d,d),c.name="satellite-".concat(t.id);let m=new s.ZzF().setFromObject(c);console.log("Satellite: 模型包围盒信息",JSON.stringify({satelliteId:t.id,scale:d,min:m.min,max:m.max,size:m.getSize(new s.Pa4),center:m.getCenter(new s.Pa4)})),c.userData={isClickable:!0,satelliteId:t.id,onSatelliteClick:i},c.traverse(e=>{e instanceof s.Kj0&&(e.userData={isClickable:!0,satelliteId:t.id,onSatelliteClick:i})});let u=new s.Ox3(16777215,1);u.position.set(5,5,5),u.target=c,o.add(u);let h=new s.Mig(4210752,.6);o.add(h),o.add(c),e.push(c),console.log("Satellite: 卫星已添加到场景",JSON.stringify({satelliteId:t.id,modelName:c.name,position:c.position,visible:c.visible,sceneChildren:o.children.length,lightsAdded:!0}))},e=>{},n=>{console.error("卫星加载失败，使用备用几何体:",t.id,t.model,n),console.error("错误详情:",{message:(null==n?void 0:n.message)||"未知错误",type:(null==n?void 0:n.type)||"未知类型",url:t.model});let c=new s.DvJ(1.5,.8,3),d=new s.xoR({color:4473924,shininess:100}),m=new s.Kj0(c,d);m.position.set(a,l,r),m.name="satellite-".concat(t.id,"-fallback"),m.userData={isClickable:!0,satelliteId:t.id,onSatelliteClick:i},o.add(m),e.push(m),console.log("Satellite: 备用几何体已添加到场景",{satelliteId:t.id,meshName:m.name,position:m.position,visible:m.visible,sceneChildren:o.children.length})})}catch(m){console.error("Satellite: GLTFLoader 创建失败",m);let n=new s.DvJ(1,.5,2),c=new s.xoR({color:4473924,shininess:100}),d=new s.Kj0(n,c);d.position.set(a,l,r),d.name="satellite-".concat(t.id,"-fallback"),d.userData={isClickable:!0,satelliteId:t.id,onSatelliteClick:i},o.add(d),e.push(d)}}),d.current.meshes=e,d.current.satelliteIds=a,()=>{d.current.meshes.forEach(e=>{o.remove(e),e.traverse(e=>{e instanceof s.Kj0&&(e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose()))})}),d.current.highlightMeshes.forEach(e=>{o.remove(e),e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose())}),d.current={meshes:[],satelliteIds:[],selectedIndex:null,highlightMeshes:new Map}}},[o,r,c,t,i]),null}},5965:function(e,t,i){"use strict";i.r(t);var a=i(2676),s=i(5271),n=i(1521),l=i(9363),o=i(426),r=i(5814),c=i(5340);t.default=e=>{let{selectedSatellite:t}=e,{camera:i,controls:d,isInitialized:m,isLoaded:u}=(0,s.useContext)(l.SceneContext);return((0,s.useEffect)(()=>{i&&d&&(i.position.set(0,0,5),i.lookAt(0,0,0),d.update(),console.log("SatelliteScene: 相机位置设置完成",{position:i.position}))},[i,d]),(0,s.useEffect)(()=>{if(!i||!d||!t)return;let[e,a,s]=t.position,l=i.position.clone(),o=new n.Pa4(e+5,a+2,s+5),r=Date.now(),c=()=>{let t=Math.min((Date.now()-r)/1e3/1.5,1);i.position.lerpVectors(l,o,1-Math.pow(1-t,3)),i.lookAt(e,a,s),d.update(),t<1&&requestAnimationFrame(c)};c()},[t,i,d]),m)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.default,{}),(0,a.jsx)(o.default,{isRotating:!0,selectedSatellite:null==t?void 0:t.id}),!u&&(0,a.jsxs)("div",{className:"loading-container",children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("p",{className:"loading-text",children:"正在加载地球模型..."})]}),t&&(0,a.jsx)(r.default,{satellites:[t],onSatelliteClick:()=>{}})]}):(0,a.jsxs)("div",{className:"loading-container",children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("p",{className:"loading-text",children:"正在初始化3D场景..."})]})}},5340:function(e,t,i){"use strict";i.r(t);var a=i(5271),s=i(1521),n=i(9363);t.default=()=>{let{scene:e,isInitialized:t}=(0,a.useContext)(n.SceneContext),i=(0,a.useRef)({stars:null,animationId:null});return(0,a.useEffect)(()=>{if(!e||!t)return;let a=()=>{if(i.current.stars){let e=.001*Date.now(),t=i.current.stars.geometry.attributes.position.array;for(let i=0;i<t.length;i+=3){let a=.1*Math.sin(2*e+.1*i)+.9;t[i+1]+=.001*Math.sin(e+i)*a}i.current.stars.geometry.attributes.position.needsUpdate=!0}i.current.animationId=requestAnimationFrame(a)};return(()=>{let t=new s.u9r,a=new Float32Array(6e3),n=new Float32Array(6e3),l=new Float32Array(2e3);for(let e=0;e<2e3;e++){let t=3*e,i=50+50*Math.random(),o=Math.random()*Math.PI*2,r=Math.acos(2*Math.random()-1);a[t]=i*Math.sin(r)*Math.cos(o),a[t+1]=i*Math.sin(r)*Math.sin(o),a[t+2]=i*Math.cos(r);let c=new s.Ilk;c.setHSL(.6+.1*Math.random(),.8,.8+.2*Math.random()),n[t]=c.r,n[t+1]=c.g,n[t+2]=c.b,l[e]=2*Math.random()+.5}t.setAttribute("position",new s.TlE(a,3)),t.setAttribute("color",new s.TlE(n,3)),t.setAttribute("size",new s.TlE(l,1));let o=new s.jyz({vertexShader:"\n                    attribute float size;\n                    attribute vec3 color;\n                    varying vec3 vColor;\n                    void main() {\n                        vColor = color;\n                        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n                        gl_PointSize = size * (300.0 / -mvPosition.z);\n                        gl_Position = projectionMatrix * mvPosition;\n                    }\n                ",fragmentShader:"\n                    varying vec3 vColor;\n                    void main() {\n                        float distance = length(gl_PointCoord - vec2(0.5));\n                        if (distance > 0.5) discard;\n                        gl_FragColor = vec4(vColor, 1.0 - distance * 2.0);\n                    }\n                ",transparent:!0,depthWrite:!1,blending:s.WMw}),r=new s.woe(t,o);e.add(r),i.current.stars=r})(),a(),()=>{i.current.animationId&&cancelAnimationFrame(i.current.animationId),i.current.stars&&(e.remove(i.current.stars),i.current.stars.geometry.dispose(),i.current.stars.material.dispose())}},[e,t]),null}}},function(e){e.O(0,[593,944,577,768,426,774,888,179],function(){return e(e.s=1413)}),_N_E=e.O()}]);
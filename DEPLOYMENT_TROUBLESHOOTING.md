# å«æ˜Ÿé¡µé¢éƒ¨ç½²é—®é¢˜æ’æŸ¥æŒ‡å—

## é—®é¢˜æè¿°

éƒ¨ç½²åå«æ˜Ÿé¡µé¢è®¿é—®æ—¶ï¼Œåœ°çƒä¸€ç›´æ˜¾ç¤ºåœ¨åŠ è½½ä¸­ï¼Œå¹¶ä¸”æ„Ÿè§‰ç‰¹åˆ«å¡ï¼Œä½†æœ¬åœ°å¼€å‘ç¯å¢ƒæ­£å¸¸ã€‚

## å¯èƒ½åŸå› åˆ†æ

### 1. çº¹ç†æ–‡ä»¶è¿‡å¤§

- **é—®é¢˜**: çº¹ç†æ–‡ä»¶éå¸¸å¤§ï¼ˆAlbedo.jpg 4.2MBï¼ŒClouds.png 7.8MBï¼‰
- **å½±å“**: åœ¨éƒ¨ç½²ç¯å¢ƒä¸­åŠ è½½ä¼šå¾ˆæ…¢ï¼Œç‰¹åˆ«æ˜¯åœ¨ç½‘ç»œè¾ƒæ…¢çš„æƒ…å†µä¸‹
- **è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨çº¹ç†å‹ç¼©å’Œä¼˜åŒ–

### 2. ç¼ºå°‘é”™è¯¯å¤„ç†

- **é—®é¢˜**: çº¹ç†åŠ è½½å¤±è´¥æ—¶æ²¡æœ‰åˆé€‚çš„é”™è¯¯å¤„ç†
- **å½±å“**: åŠ è½½å¤±è´¥æ—¶ç”¨æˆ·çœ‹ä¸åˆ°ä»»ä½•åé¦ˆ
- **è§£å†³æ–¹æ¡ˆ**: æ·»åŠ å®Œå–„çš„é”™è¯¯å¤„ç†å’Œå¤‡ç”¨æ–¹æ¡ˆ

### 3. æ€§èƒ½ä¼˜åŒ–ä¸è¶³

- **é—®é¢˜**: æ²¡æœ‰é’ˆå¯¹éƒ¨ç½²ç¯å¢ƒè¿›è¡Œæ€§èƒ½ä¼˜åŒ–
- **å½±å“**: åœ¨æ€§èƒ½è¾ƒå·®çš„è®¾å¤‡ä¸Šè¿è¡Œç¼“æ…¢
- **è§£å†³æ–¹æ¡ˆ**: æ·»åŠ æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–

## è§£å†³æ–¹æ¡ˆ

### 1. çº¹ç†ä¼˜åŒ–

è¿è¡Œçº¹ç†ä¼˜åŒ–è„šæœ¬ï¼š

```bash
npm run optimize-textures
```

æˆ–è€…æ‰‹åŠ¨ä¼˜åŒ–ï¼š

```bash
# å®‰è£…ImageMagick
brew install imagemagick  # macOS
sudo apt-get install imagemagick  # Ubuntu

# è¿è¡Œä¼˜åŒ–è„šæœ¬
node scripts/optimize-textures.js
```

### 2. ä½¿ç”¨ä¼˜åŒ–åçš„æ„å»º

```bash
npm run build-optimized
```

### 3. æ€§èƒ½ç›‘æ§

é¡µé¢å³ä¸Šè§’æœ‰æ€§èƒ½ç›‘æ§æŒ‰é’®ï¼ˆğŸ“Šï¼‰ï¼Œç‚¹å‡»å¯ä»¥æŸ¥çœ‹ï¼š

- å¸§ç‡ï¼ˆFPSï¼‰
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- æ¸²æŸ“ç»Ÿè®¡

### 4. è°ƒè¯•æ­¥éª¤

#### æ­¥éª¤ 1: æ£€æŸ¥æ§åˆ¶å°é”™è¯¯

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
2. æŸ¥çœ‹ Console æ ‡ç­¾é¡µ
3. æŸ¥æ‰¾ä»»ä½•é”™è¯¯ä¿¡æ¯

#### æ­¥éª¤ 2: æ£€æŸ¥ç½‘ç»œè¯·æ±‚

1. æ‰“å¼€ Network æ ‡ç­¾é¡µ
2. åˆ·æ–°é¡µé¢
3. æŸ¥çœ‹çº¹ç†æ–‡ä»¶çš„åŠ è½½æƒ…å†µ
4. æ£€æŸ¥æ˜¯å¦æœ‰ 404 é”™è¯¯

#### æ­¥éª¤ 3: æ£€æŸ¥ WebGL æ”¯æŒ

1. åœ¨æ§åˆ¶å°è¿è¡Œï¼š`console.log(THREE.WEBGL.isWebGLAvailable())`
2. å¦‚æœè¿”å› falseï¼Œè¯´æ˜ WebGL ä¸å—æ”¯æŒ

#### æ­¥éª¤ 4: æ€§èƒ½åˆ†æ

1. ç‚¹å‡»æ€§èƒ½ç›‘æ§æŒ‰é’®
2. æŸ¥çœ‹ FPS æ˜¯å¦ä½äº 30
3. æ£€æŸ¥å†…å­˜ä½¿ç”¨æ˜¯å¦è¿‡é«˜

### 5. å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ³•

#### é—®é¢˜ 1: çº¹ç†åŠ è½½è¶…æ—¶

**ç—‡çŠ¶**: æ§åˆ¶å°æ˜¾ç¤ºçº¹ç†åŠ è½½è¶…æ—¶é”™è¯¯
**è§£å†³**:

- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ä½¿ç”¨ä¼˜åŒ–åçš„çº¹ç†æ–‡ä»¶
- å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆåœ¨ Earth.tsx ä¸­ä¿®æ”¹ textureLoadTimeoutï¼‰

#### é—®é¢˜ 2: WebGL ä¸æ”¯æŒ

**ç—‡çŠ¶**: é¡µé¢æ˜¾ç¤º"WebGL ä¸å—æ”¯æŒ"é”™è¯¯
**è§£å†³**:

- æ›´æ–°æ˜¾å¡é©±åŠ¨
- å¯ç”¨ç¡¬ä»¶åŠ é€Ÿ
- å°è¯•ä¸åŒçš„æµè§ˆå™¨

#### é—®é¢˜ 3: å†…å­˜ä¸è¶³

**ç—‡çŠ¶**: é¡µé¢å¡é¡¿ï¼Œæ€§èƒ½ç›‘æ§æ˜¾ç¤ºé«˜å†…å­˜ä½¿ç”¨
**è§£å†³**:

- å‡å°‘çº¹ç†åˆ†è¾¨ç‡
- é™ä½å‡ ä½•ä½“å¤æ‚åº¦
- å¯ç”¨çº¹ç†å‹ç¼©

#### é—®é¢˜ 4: ä½å¸§ç‡

**ç—‡çŠ¶**: FPS ä½äº 30
**è§£å†³**:

- é™ä½æ¸²æŸ“è´¨é‡
- å‡å°‘ç¯å…‰æ•°é‡
- ä¼˜åŒ–å‡ ä½•ä½“

### 6. ä»£ç ä¼˜åŒ–å»ºè®®

#### çº¹ç†åŠ è½½ä¼˜åŒ–

```typescript
// æ·»åŠ é‡è¯•æœºåˆ¶
const loadTextureWithTimeout = (path: string, timeout: number) => {
  return Promise.race([
    resourceManager.loadTexture(path),
    new Promise<THREE.Texture>((_, reject) =>
      setTimeout(() => reject(new Error(`çº¹ç†åŠ è½½è¶…æ—¶: ${path}`)), timeout)
    )
  ]);
};
```

#### æ€§èƒ½ç›‘æ§

```typescript
// ç›‘æ§FPS
if (fps < 30) {
  console.warn(`ä½å¸§ç‡è­¦å‘Š - ${fps} FPS`);
}
```

#### é”™è¯¯å¤„ç†

```typescript
// æ·»åŠ å¤‡ç”¨æ–¹æ¡ˆ
if (!hasTextures) {
  console.warn('éƒ¨åˆ†çº¹ç†åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬');
  // ä½¿ç”¨åŸºç¡€æè´¨
}
```

### 7. éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] çº¹ç†æ–‡ä»¶å·²ä¼˜åŒ–ï¼ˆå¤§å° < 1MBï¼‰
- [ ] æ·»åŠ äº†é”™è¯¯å¤„ç†
- [ ] æ·»åŠ äº†æ€§èƒ½ç›‘æ§
- [ ] æµ‹è¯•äº†ä¸åŒç½‘ç»œç¯å¢ƒ
- [ ] æµ‹è¯•äº†ä¸åŒè®¾å¤‡
- [ ] æ£€æŸ¥äº† WebGL æ”¯æŒ
- [ ] éªŒè¯äº†å¤‡ç”¨æ–¹æ¡ˆ

### 8. æ€§èƒ½ä¼˜åŒ–é…ç½®

åœ¨`next.config.js`ä¸­æ·»åŠ ï¼š

```javascript
const nextConfig = {
  reactStrictMode: false,
  swcMinify: true,
  output: 'export',
  trailingSlash: true,
  // æ·»åŠ æ€§èƒ½ä¼˜åŒ–
  experimental: {
    optimizeCss: true,
    optimizePackageImports: ['three', '@react-three/fiber']
  }
};
```

### 9. ç›‘æ§å’Œç»´æŠ¤

1. **å®šæœŸæ£€æŸ¥æ€§èƒ½**: ä½¿ç”¨æ€§èƒ½ç›‘æ§å·¥å…·
2. **ç›‘æ§é”™è¯¯**: è®¾ç½®é”™è¯¯ç›‘æ§
3. **ç”¨æˆ·åé¦ˆ**: æ”¶é›†ç”¨æˆ·ä½¿ç”¨åé¦ˆ
4. **å®šæœŸä¼˜åŒ–**: æ ¹æ®ä½¿ç”¨æƒ…å†µæŒç»­ä¼˜åŒ–

## è”ç³»æ”¯æŒ

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. æµè§ˆå™¨ç‰ˆæœ¬å’Œæ“ä½œç³»ç»Ÿ
2. æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
3. ç½‘ç»œè¯·æ±‚æ—¥å¿—
4. æ€§èƒ½ç›‘æ§æ•°æ®
5. è®¾å¤‡é…ç½®ä¿¡æ¯
